#pragma checksum "/home/yjin/TspWithGeneticSharp/Pages/Tsp.razor" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "cbf1b3843168cbb9bdf7396eb15d02790bd3e40c"
// <auto-generated/>
#pragma warning disable 1591
namespace TspWithGeneticSharp.Pages
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#line 1 "/home/yjin/TspWithGeneticSharp/_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#line 2 "/home/yjin/TspWithGeneticSharp/_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#line 3 "/home/yjin/TspWithGeneticSharp/_Imports.razor"
using Microsoft.AspNetCore.Components.Layouts;

#line default
#line hidden
#line 4 "/home/yjin/TspWithGeneticSharp/_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#line 5 "/home/yjin/TspWithGeneticSharp/_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#line 6 "/home/yjin/TspWithGeneticSharp/_Imports.razor"
using TspWithGeneticSharp;

#line default
#line hidden
#line 7 "/home/yjin/TspWithGeneticSharp/_Imports.razor"
using TspWithGeneticSharp.Shared;

#line default
#line hidden
    [Microsoft.AspNetCore.Components.Layouts.LayoutAttribute(typeof(MainLayout))]
    [Microsoft.AspNetCore.Components.RouteAttribute("/tsp")]
    public class Tsp : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.RenderTree.RenderTreeBuilder builder)
        {
            builder.OpenElement(0, "div");
            builder.AddAttribute(1, "class", "container");
            builder.AddMarkupContent(2, "\n     ");
            builder.OpenElement(3, "div");
            builder.AddAttribute(4, "class", "row");
            builder.AddMarkupContent(5, "\n        ");
            builder.OpenElement(6, "div");
            builder.AddMarkupContent(7, "\n            Cities: ");
            builder.OpenElement(8, "input");
            builder.AddAttribute(9, "type", "text");
            builder.AddAttribute(10, "onblur", 
#line 7 "/home/yjin/TspWithGeneticSharp/Pages/Tsp.razor"
                                                                      ResetGA

#line default
#line hidden
            );
            builder.AddAttribute(11, "disabled", 
#line 7 "/home/yjin/TspWithGeneticSharp/Pages/Tsp.razor"
                                                                                        _tspGA.IsRunning

#line default
#line hidden
            );
            builder.AddAttribute(12, "value", Microsoft.AspNetCore.Components.BindMethods.GetValue(
#line 7 "/home/yjin/TspWithGeneticSharp/Pages/Tsp.razor"
                                              _numberOfCities

#line default
#line hidden
            ));
            builder.AddAttribute(13, "onchange", Microsoft.AspNetCore.Components.EventCallback.Factory.CreateBinder(this, __value => _numberOfCities = __value, _numberOfCities));
            builder.CloseElement();
            builder.AddMarkupContent(14, "\n        ");
            builder.CloseElement();
            builder.AddMarkupContent(15, "\n         ");
            builder.OpenElement(16, "div");
            builder.AddMarkupContent(17, "\n            ");
            builder.OpenElement(18, "button");
            builder.AddAttribute(19, "onclick", 
#line 10 "/home/yjin/TspWithGeneticSharp/Pages/Tsp.razor"
                             ResetGA

#line default
#line hidden
            );
            builder.AddAttribute(20, "disabled", 
#line 10 "/home/yjin/TspWithGeneticSharp/Pages/Tsp.razor"
                                               _tspGA.IsRunning

#line default
#line hidden
            );
            builder.AddContent(21, "Reset");
            builder.CloseElement();
            builder.AddMarkupContent(22, "\n        ");
            builder.CloseElement();
            builder.AddMarkupContent(23, "\n        ");
            builder.OpenElement(24, "div");
            builder.AddMarkupContent(25, "\n            ");
            builder.OpenElement(26, "button");
            builder.AddAttribute(27, "onclick", 
#line 13 "/home/yjin/TspWithGeneticSharp/Pages/Tsp.razor"
                             _tspGA.Run

#line default
#line hidden
            );
            builder.AddAttribute(28, "disabled", 
#line 13 "/home/yjin/TspWithGeneticSharp/Pages/Tsp.razor"
                                                  _tspGA.IsRunning

#line default
#line hidden
            );
            builder.AddContent(29, "Run");
            builder.CloseElement();
            builder.AddMarkupContent(30, "\n        ");
            builder.CloseElement();
            builder.AddMarkupContent(31, "\n        ");
            builder.OpenElement(32, "div");
            builder.AddMarkupContent(33, "\n            ");
            builder.OpenElement(34, "button");
            builder.AddAttribute(35, "onclick", 
#line 16 "/home/yjin/TspWithGeneticSharp/Pages/Tsp.razor"
                             StopGA

#line default
#line hidden
            );
            builder.AddAttribute(36, "disabled", 
#line 16 "/home/yjin/TspWithGeneticSharp/Pages/Tsp.razor"
                                               !_tspGA.IsRunning

#line default
#line hidden
            );
            builder.AddContent(37, "Stop");
            builder.CloseElement();
            builder.AddMarkupContent(38, "\n        ");
            builder.CloseElement();
            builder.AddMarkupContent(39, "\n    ");
            builder.CloseElement();
            builder.AddMarkupContent(40, "\n    ");
            builder.OpenElement(41, "div");
            builder.AddAttribute(42, "class", "row");
            builder.AddMarkupContent(43, "\n        ");
            builder.OpenElement(44, "div");
            builder.AddAttribute(45, "class", "col alert alert-info");
            builder.AddContent(46, "Generations: ");
            builder.AddContent(47, 
#line 20 "/home/yjin/TspWithGeneticSharp/Pages/Tsp.razor"
                                                        _tspGA.GenerationsNumber

#line default
#line hidden
            );
            builder.CloseElement();
            builder.AddMarkupContent(48, "\n        ");
            builder.OpenElement(49, "div");
            builder.AddAttribute(50, "class", "col alert alert-info");
            builder.AddContent(51, "Distance: ");
            builder.AddContent(52, 
#line 21 "/home/yjin/TspWithGeneticSharp/Pages/Tsp.razor"
                                                     _tspGA.BestChromosome?.Distance

#line default
#line hidden
            );
            builder.CloseElement();
            builder.AddMarkupContent(53, "\n    ");
            builder.CloseElement();
            builder.AddMarkupContent(54, "\n ");
            builder.CloseElement();
            builder.AddMarkupContent(55, "\n\n");
            builder.AddMarkupContent(56, "<canvas id=\"canvas\" style=\"border:1px solid #d3d3d3;\">Your browser does not support the HTML5 canvas tag.</canvas>");
        }
        #pragma warning restore 1998
#line 27 "/home/yjin/TspWithGeneticSharp/Pages/Tsp.razor"
       
    int _numberOfCities = 10;
    int _canvasWidth;
    int _canvasHeight;
    bool _initialized;
    TspGA _tspGA = new TspGA();

    async Task InitializeGAAsync()
    {
        // This need to be called after the first render to get
        // the size of the canvas.
        var size = await _js.InvokeAsync<int[]>("initializeCanvas");
        _canvasWidth = size[0];
        _canvasHeight = size[1];
        _tspGA.GenerationRan += HandleGenerationRan;
        ResetGA();
    }

    void HandleGenerationRan()
    {
        Console.WriteLine($"Generation: {_tspGA.GenerationsNumber} - Distance: {_tspGA.BestChromosome.Distance}");
        StateHasChanged();
    }

    void ResetGA()
    {
        _tspGA.Initialize(_numberOfCities, _canvasWidth, _canvasHeight);
        StateHasChanged();
    }

    void StopGA()
    {
        _tspGA.Stop();
        StateHasChanged();
    }

    protected override async Task OnAfterRenderAsync()
    {
        if (!_initialized) {
            _initialized = true;
            await InitializeGAAsync();
        }
        
        await _js.InvokeAsync<object>("clearCanvas");
        await DrawCitiesAsync();
        await DrawRouteAsync();
    }
    async Task DrawCitiesAsync()
{
    foreach(var city in _tspGA.Fitness.Cities)
        await _js.InvokeAsync<object>("drawCircle", city.X, city.Y, 10);
} 
async Task DrawRouteAsync()
{
    var bestChromosome = _tspGA.BestChromosome;

    if(bestChromosome != null)
    {
        var genes = bestChromosome.GetGenes();
        var fitness = _tspGA.Fitness;
        var firstCity = fitness.Cities[(int)genes[0].Value];
        var previousCity = firstCity;

        for(var i = 1; i < genes.Length; i++)
        {
            var city = fitness.Cities[(int)genes[i].Value];
            await _js.InvokeAsync<object>("drawLine", previousCity.X, previousCity.Y, city.X, city.Y);

            previousCity = city;
        }

        await _js.InvokeAsync<object>("drawLine", previousCity.X, previousCity.Y, firstCity.X, firstCity.Y);
    }
}

#line default
#line hidden
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IJSRuntime _js { get; set; }
    }
}
#pragma warning restore 1591
